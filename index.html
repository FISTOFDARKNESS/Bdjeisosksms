<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excalibur - Music Player</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-base: #05060A;
            --bg-surface: #0A0B10;
            --bg-raised: #12141F;
            --bg-glass: rgba(15, 17, 30, 0.55);
            --primary: #FF2E88;
            --secondary: #21D4FD;
            --accent: #F5A623;
            --text-primary: #F5F7FF;
            --text-secondary: #B0B3C6;
            --border-glass: rgba(255, 255, 255, 0.14);
            --glow-primary: rgba(255, 46, 136, 0.65);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-base);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .bg-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .particle { position: absolute; width: 2px; height: 2px; background: var(--secondary); border-radius: 50%; opacity: 0.3; animation: float 15s infinite linear; }
        @keyframes float { from { transform: translateY(100vh); } to { transform: translateY(-10vh); } }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; position: relative; z-index: 1; }

        header { padding: 30px 0; }
        .header-glass { 
            background: var(--bg-glass); 
            backdrop-filter: blur(15px); 
            border: 1px solid var(--border-glass); 
            border-radius: 20px; 
            padding: 15px 30px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .logo { font-size: 24px; font-weight: 800; background: linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .hero { text-align: center; padding: 100px 0; }
        .hero h1 { font-size: 80px; font-weight: 800; letter-spacing: -3px; margin-bottom: 20px; }
        
        .btn { padding: 15px 35px; border-radius: 15px; font-weight: 600; cursor: pointer; border: none; transition: 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary { background: var(--primary); color: white; box-shadow: 0 10px 20px var(--glow-primary); }
        .btn-primary:hover { transform: scale(1.05); }

        .download-count { font-size: 60px; font-weight: 800; color: var(--secondary); margin-top: 50px; }

        .feedback-form { background: var(--bg-raised); padding: 40px; border-radius: 25px; max-width: 500px; margin: 50px auto; border: 1px solid var(--border-glass); }
        .form-group { margin-bottom: 20px; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px; background: var(--bg-surface); border: 1px solid var(--border-glass); border-radius: 10px; color: white; outline: none; }
        
        .rating-stars { display: flex; gap: 10px; margin: 10px 0; font-size: 25px; }
        .star { cursor: pointer; color: #333; transition: 0.2s; }
        .star.active { color: var(--accent); }

        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { background: var(--bg-raised); padding: 40px; border-radius: 25px; width: 90%; max-width: 500px; }
        
        .version-item { background: var(--bg-surface); padding: 20px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-glass); }
        .version-tag { background: var(--primary); font-size: 10px; padding: 3px 8px; border-radius: 5px; text-transform: uppercase; }
        .download-link { color: var(--secondary); font-weight: 700; text-decoration: none; }

        .msg { display: none; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center; }
        .success { background: rgba(0,255,100,0.1); color: #00ff64; border: 1px solid #00ff64; }
    </style>
</head>
<body>

    <div class="bg-particles" id="particles"></div>

    <header class="container">
        <div class="header-glass">
            <div class="logo">EXCALIBUR</div>
            <button class="btn btn-primary" id="openModal">Get App</button>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <h1>EXCALIBUR</h1>
            <p>Seu player de música, sua espada.</p>
            <div class="download-count" id="count">0</div>
            <p>Syncs Realizados</p>
        </section>

        <section class="feedback-form">
            <h2 style="margin-bottom: 20px">Feedback</h2>
            <form id="feedbackForm">
                <div class="form-group"><input type="text" id="name" class="form-input" placeholder="Seu Nome" required></div>
                <div class="form-group"><input type="email" id="email" class="form-input" placeholder="Seu E-mail" required></div>
                <div class="form-group">
                    <div class="rating-stars">
                        <span class="star" data-v="1">★</span><span class="star" data-v="2">★</span><span class="star" data-v="3">★</span><span class="star" data-v="4">★</span><span class="star" data-v="5">★</span>
                    </div>
                    <input type="hidden" id="rating" value="0">
                </div>
                <div class="form-group">
                    <select id="type" class="form-select">
                        <option value="feature">Sugestão</option>
                        <option value="bug">Erro/Bug</option>
                    </select>
                </div>
                <div class="form-group"><textarea id="message" class="form-textarea" rows="4" placeholder="Sua mensagem..."></textarea></div>
                <button type="submit" class="btn btn-primary" style="width: 100%">Enviar</button>
                <div id="resp" class="msg"></div>
            </form>
        </section>
    </main>

    <div class="modal" id="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px">
                <h2>Downloads</h2>
                <button id="close" style="background:none; border:none; color:white; font-size:25px; cursor:pointer">&times;</button>
            </div>
            <div id="list"></div>
        </div>
    </div>

    <script>
        const API = '/.netlify/functions/database';

        async function init() {
            try {
                const res = await fetch(API);
                const data = await res.json();
                document.getElementById('count').innerText = (data.length * 42).toLocaleString();
                document.getElementById('list').innerHTML = data.map(v => `
                    <div class="version-item">
                        <div>
                            <span class="version-tag">${v.is_latest ? 'Latest' : 'Stable'}</span>
                            <div style="font-weight:700; margin-top:5px">${v.version_name}</div>
                        </div>
                        <a href="${v.download_url}" class="download-link">BAIXAR</a>
                    </div>
                `).join('');
            } catch (e) { console.error(e); }
        }

        document.getElementById('feedbackForm').onsubmit = async (e) => {
            e.preventDefault();
            const r = document.getElementById('resp');
            const btn = e.target.querySelector('button');
            btn.disabled = true;

            const body = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                rating: document.getElementById('rating').value,
                type: document.getElementById('type').value,
                message: document.getElementById('message').value
            };

            try {
                const res = await fetch(API, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if(res.ok) {
                    r.innerText = "Enviado com sucesso!";
                    r.className = "msg success";
                    r.style.display = "block";
                    e.target.reset();
                }
            } catch (err) { console.error(err); }
            finally { btn.disabled = false; }
        };

        document.querySelectorAll('.star').forEach(s => s.onclick = () => {
            const v = s.dataset.v;
            document.getElementById('rating').value = v;
            document.querySelectorAll('.star').forEach(x => x.classList.toggle('active', x.dataset.v <= v));
        });

        document.getElementById('openModal').onclick = () => document.getElementById('modal').style.display = 'flex';
        document.getElementById('close').onclick = () => document.getElementById('modal').style.display = 'none';

        const p = document.getElementById('particles');
        for(let i=0; i<15; i++) {
            const d = document.createElement('div');
            d.className = 'particle';
            d.style.left = Math.random()*100+'%';
            d.style.animationDelay = Math.random()*10+'s';
            p.appendChild(d);
        }

        window.onload = init;
    </script>
</body>
</html>
