<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excalibur - Music Player</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-base: #05060A;
            --bg-surface: #0A0B10;
            --bg-raised: #12141F;
            --bg-glass: rgba(15, 17, 30, 0.55);
            --primary: #FF2E88;
            --primary-variant: #F92672;
            --secondary: #21D4FD;
            --secondary-variant: #00E5FF;
            --accent: #F5A623;
            --text-primary: #F5F7FF;
            --text-secondary: #B0B3C6;
            --text-disabled: #6B6E80;
            --border-glass: rgba(255, 255, 255, 0.14);
            --border-soft: rgba(255, 255, 255, 0.06);
            --shadow-strong: rgba(0, 0, 0, 0.75);
            --shadow-soft: rgba(0, 0, 0, 0.45);
            --glow-primary: rgba(255, 46, 136, 0.65);
            --glow-secondary: rgba(33, 212, 253, 0.65);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #050816 0%, #0A0B10 50%, #101320 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        .bg-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .particle { position: absolute; width: 2px; height: 2px; background: var(--secondary); border-radius: 50%; opacity: 0.3; animation: float 20s infinite ease-in-out; }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-200px) translateX(-30px); }
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 24px; position: relative; z-index: 1; }
        header { position: sticky; top: 0; z-index: 100; padding: 20px 0; margin-bottom: 60px; }
        .header-glass { background: var(--bg-glass); backdrop-filter: blur(22px); -webkit-backdrop-filter: blur(22px); border: 1px solid var(--border-glass); border-radius: 24px; padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 18px 40px var(--shadow-soft); }
        .logo { font-size: 28px; font-weight: 800; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -0.5px; }
        nav { display: flex; gap: 32px; align-items: center; }
        nav a { color: var(--text-secondary); text-decoration: none; font-weight: 500; font-size: 15px; transition: all 0.3s ease; position: relative; }
        nav a:hover { color: var(--text-primary); }

        .hero { text-align: center; padding: 80px 0 120px; }
        .hero h1 { font-size: clamp(48px, 8vw, 96px); font-weight: 800; line-height: 1.1; margin-bottom: 24px; background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -2px; }
        .hero .subtitle { font-size: clamp(18px, 3vw, 24px); color: var(--text-secondary); margin-bottom: 48px; max-width: 700px; margin-left: auto; margin-right: auto; }

        .cta-buttons { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .btn { padding: 16px 40px; border-radius: 20px; font-weight: 600; font-size: 16px; cursor: pointer; border: none; transition: all 0.3s ease; text-decoration: none; display: inline-block; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-variant) 100%); color: white; box-shadow: 0 10px 30px rgba(255, 46, 136, 0.4), 0 0 40px var(--glow-primary); }
        .btn-secondary { background: var(--bg-raised); color: var(--text-primary); border: 1px solid var(--border-glass); }

        .player-card { background: var(--bg-raised); border-radius: 32px; padding: 48px; max-width: 900px; width: 100%; margin: 0 auto; border: 1px solid var(--border-soft); box-shadow: 20px 20px 60px var(--shadow-strong); }
        .album-art { width: 100%; aspect-ratio: 1; border-radius: 24px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); margin-bottom: 32px; }
        .track-title { font-size: 32px; font-weight: 700; margin-bottom: 8px; }

        .visualizer { height: 80px; display: flex; align-items: flex-end; gap: 4px; justify-content: center; margin-bottom: 32px; }
        .bar { width: 6px; background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 3px; animation: pulse 1.2s ease-in-out infinite; }

        @keyframes pulse { 0%, 100% { transform: scaleY(1); } 50% { transform: scaleY(1.4); } }

        .progress-bar { width: 100%; height: 6px; background: var(--bg-surface); border-radius: 999px; overflow: hidden; margin-bottom: 8px; }
        .progress-fill { height: 100%; width: 45%; background: var(--primary); box-shadow: 0 0 12px var(--glow-primary); }

        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px; margin-top: 60px; }
        .feature-card { background: var(--bg-raised); border-radius: 24px; padding: 40px; border: 1px solid var(--border-soft); transition: 0.3s; }
        .feature-card:hover { transform: translateY(-8px); border-color: var(--secondary); box-shadow: 0 0 40px var(--glow-secondary); }

        .download-stats { text-align: center; margin-bottom: 48px; }
        .download-count { font-size: clamp(48px, 8vw, 72px); font-weight: 800; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

        .feedback-form { max-width: 600px; margin: 0 auto; background: var(--bg-raised); padding: 48px; border-radius: 32px; border: 1px solid var(--border-soft); }
        .form-group { margin-bottom: 24px; }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 16px; background: var(--bg-surface); border: 1px solid var(--border-soft); border-radius: 16px; color: white; }
        .rating-stars { display: flex; gap: 8px; margin-top: 8px; }
        .star { font-size: 32px; color: var(--text-disabled); cursor: pointer; }
        .star.active { color: var(--accent); }

        .download-modal { display: none; position: fixed; inset: 0; background: rgba(5, 6, 10, 0.9); backdrop-filter: blur(10px); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: var(--bg-raised); border-radius: 32px; padding: 48px; max-width: 600px; width: 90%; border: 1px solid var(--border-glass); }
        .version-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: var(--bg-surface); border-radius: 20px; margin-bottom: 16px; transition: 0.3s; }
        .version-item:hover { transform: translateX(8px); border-color: var(--primary); }
        .version-tag { background: var(--primary); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 700; }
        .version-tag.latest { background: var(--accent); }
        .download-link { background: var(--primary); color: white; padding: 10px 24px; border-radius: 16px; text-decoration: none; font-weight: 600; }

        .feedback-response { display: none; margin-top: 24px; padding: 20px; border-radius: 16px; text-align: center; }
        .feedback-response.success { background: rgba(0, 255, 136, 0.1); color: #00FF88; border: 1px solid #00FF88; }
        .feedback-response.error { background: rgba(255, 46, 136, 0.1); color: var(--primary); border: 1px solid var(--primary); }
    </style>
</head>
<body>
    <div class="bg-particles" id="particles"></div>

    <header>
        <div class="container">
            <div class="header-glass">
                <div class="logo">EXCALIBUR</div>
                <nav>
                    <a href="#features">Features</a>
                    <a href="#download">Download</a>
                    <a href="#feedback">Feedback</a>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <section class="hero">
            <h1>EXCALIBUR</h1>
            <p class="subtitle">Your music, your sword</p>
            <div class="cta-buttons">
                <button class="btn btn-primary" id="openDownloadModal">Download Now</button>
                <a href="#features" class="btn btn-secondary">Explore</a>
            </div>
        </section>

        <section class="player-showcase">
            <div class="player-card">
                <div class="album-art"></div>
                <div class="track-info">
                    <h2 class="track-title">Live Preview</h2>
                    <p style="color: var(--text-secondary)">Neon Database Connected</p>
                </div>
                <div class="visualizer">
                    <div class="bar" style="height: 40%"></div>
                    <div class="bar" style="height: 80%"></div>
                    <div class="bar" style="height: 60%"></div>
                    <div class="bar" style="height: 90%"></div>
                    <div class="bar" style="height: 50%"></div>
                </div>
                <div class="progress-bar"><div class="progress-fill"></div></div>
            </div>
        </section>

        <section id="features" style="padding: 100px 0;">
            <div class="features-grid">
                <div class="feature-card"><h3>200 Themes</h3><p>Dynamic palettes with Material You.</p></div>
                <div class="feature-card"><h3>Glassmorphism</h3><p>Frosted glass and immersive blur.</p></div>
                <div class="feature-card"><h3>Neon Sync</h3><p>Real-time updates from cloud DB.</p></div>
            </div>
        </section>

        <section id="download" style="padding: 100px 0;">
            <div class="download-stats">
                <div class="download-count" id="totalDownloads">...</div>
                <div class="download-label">Total Cloud Syncs</div>
            </div>
        </section>

        <section id="feedback" style="padding: 100px 0;">
            <div class="feedback-form">
                <form id="feedbackForm">
                    <div class="form-group"><input type="text" id="name" class="form-input" placeholder="Name" required></div>
                    <div class="form-group"><input type="email" id="email" class="form-input" placeholder="Email" required></div>
                    <div class="form-group">
                        <label>Rating</label>
                        <div class="rating-stars" id="ratingStars">
                            <span class="star" data-value="1">★</span><span class="star" data-value="2">★</span><span class="star" data-value="3">★</span><span class="star" data-value="4">★</span><span class="star" data-value="5">★</span>
                        </div>
                        <input type="hidden" id="rating" value="0">
                    </div>
                    <div class="form-group">
                        <select id="type" class="form-select" required>
                            <option value="">Type</option>
                            <option value="bug">Bug</option>
                            <option value="feature">Feature</option>
                        </select>
                    </div>
                    <div class="form-group"><textarea id="message" class="form-textarea" placeholder="Message" required></textarea></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Send Feedback</button>
                </form>
                <div id="feedbackResponse" class="feedback-response"></div>
            </div>
        </section>
    </div>

    <div class="download-modal" id="downloadModal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; margin-bottom: 32px;">
                <h2>Versions</h2>
                <button id="closeModal" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div id="versionList"></div>
        </div>
    </div>

    <script>
        const API_URL = '/.netlify/functions/database';

        async function loadData() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                document.getElementById('totalDownloads').innerText = (data.length * 120).toLocaleString();
                document.getElementById('versionList').innerHTML = data.map(v => `
                    <div class="version-item">
                        <div>
                            <span class="version-tag ${v.is_latest ? 'latest' : ''}">${v.is_latest ? 'Latest' : 'Stable'}</span>
                            <div style="margin-top: 8px; font-weight: 700;">${v.version_name}</div>
                        </div>
                        <a href="${v.download_url}" class="download-link">Get</a>
                    </div>
                `).join('');
            } catch (e) { console.error(e); }
        }

        document.getElementById('feedbackForm').onsubmit = async (e) => {
            e.preventDefault();
            const out = document.getElementById('feedbackResponse');
            const btn = e.target.querySelector('button');
            btn.disabled = true;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        name: document.getElementById('name').value,
                        email: document.getElementById('email').value,
                        rating: document.getElementById('rating').value,
                        type: document.getElementById('type').value,
                        message: document.getElementById('message').value
                    })
                });
                if(res.ok) {
                    out.innerText = "Success!";
                    out.className = "feedback-response success";
                    e.target.reset();
                }
            } catch (err) {
                out.innerText = "Error!";
                out.className = "feedback-response error";
            } finally {
                out.style.display = "block";
                btn.disabled = false;
            }
        };

        const stars = document.querySelectorAll('.star');
        stars.forEach(s => s.onclick = () => {
            const val = s.dataset.value;
            document.getElementById('rating').value = val;
            stars.forEach(st => st.classList.toggle('active', st.dataset.value <= val));
        });

        document.getElementById('openDownloadModal').onclick = () => document.getElementById('downloadModal').style.display = 'flex';
        document.getElementById('closeModal').onclick = () => document.getElementById('downloadModal').style.display = 'none';

        const parts = document.getElementById('particles');
        for(let i=0; i<20; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random()*100+'%';
            p.style.top = Math.random()*100+'%';
            p.style.animationDelay = Math.random()*5+'s';
            parts.appendChild(p);
        }

        window.onload = loadData;
    </script>
</body>
</html>
