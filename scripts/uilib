local UiLib = {}
local UI = UiLib
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Credits",
    Text = "Ui Library made by _.yzero",
    Duration = 20
})

local mensagem = "Excalibur Hub | Loading: "
for i = 0, 100, 1 do
    task.wait(0.001)
    warn(mensagem .. i .. "%")
end
print("Excalibur Hub | UI Library Loaded")

UI.Theme = {
    Primary = Color3.fromRGB(30,30,40),
    Secondary = Color3.fromRGB(40,40,50),
    Accent = Color3.fromRGB(120,81,169),
    Button = Color3.fromRGB(60,60,70),
    ToggleOn = Color3.fromRGB(120,255,120),
    ToggleOff = Color3.fromRGB(255,120,120),
    AutoSaveOn = Color3.fromRGB(120,255,120),
    AutoSaveOff = Color3.fromRGB(255,120,120),
    Text = Color3.fromRGB(255,255,255),
    Stroke = Color3.fromRGB(80,80,100),
    TabIconSelected = Color3.fromRGB(255,255,255),
    TabIconUnselected = Color3.fromRGB(180,180,180)
}

UI.Font = Enum.Font.Gotham
UI.FontBold = Enum.Font.GothamBold

function UI:New(class, props)
    local obj = Instance.new(class)
    for k,v in pairs(props) do obj[k]=v end
    return obj
end

function UI:ApplyTheme(win, theme)
    theme = theme or UI.Theme
    for _, tab in pairs(win.Tabs) do
        tab.Button.BackgroundColor3 = theme.Button
        tab.Button.TextColor3 = theme.Text
        for _, child in pairs(tab.Content:GetChildren()) do
            if child:IsA("Frame") then
                for _, inner in pairs(child:GetChildren()) do
                    if inner:IsA("TextLabel") or inner:IsA("TextBox") then
                        inner.TextColor3 = theme.Text
                    elseif inner:IsA("TextButton") then
                        inner.BackgroundColor3 = theme.Button
                        inner.TextColor3 = theme.Text
                    end
                end
            end
        end
    end
    win.Main.BackgroundColor3 = theme.Primary
end

function UI:CreateWindow(opt)
    opt = opt or {}
    local gui = UI:New("ScreenGui",{Parent=game:GetService("CoreGui"),ResetOnSpawn=false})
    local main = UI:New("Frame",{
        Size=UDim2.new(0,320,0,500),
        Position=UDim2.fromScale(.5,.5),
        AnchorPoint=Vector2.new(.5,.5),
        BackgroundColor3=UI.Theme.Primary,
        BorderSizePixel=0,
        Parent=gui
    })
    UI:New("UICorner",{CornerRadius=UDim.new(0,12),Parent=main})
    UI:New("UIStroke",{Color=UI.Theme.Stroke,Thickness=2,Parent=main})

    -- Title Bar
    local title = UI:New("Frame",{
        Size=UDim2.new(1,0,0,45),
        BackgroundColor3=UI.Theme.Secondary,
        Parent=main
    })
    UI:New("UICorner",{CornerRadius=UDim.new(0,12,0,0),Parent=title})
    local titleLabel = UI:New("TextLabel",{
        Size=UDim2.new(1,-40,1,0),
        BackgroundTransparency=1,
        Text=opt.Title or "Excalibur Hub",
        Font=UI.FontBold,
        TextSize=18,
        TextColor3=UI.Theme.Text,
        Parent=title
    })
    local close = UI:New("TextButton",{
        Size=UDim2.new(0,45,1,0),
        Position=UDim2.new(1,-45,0,0),
        BackgroundTransparency=1,
        Text="X",
        Font=UI.FontBold,
        TextSize=20,
        TextColor3=UI.Theme.Text,
        Parent=title
    })
    close.MouseButton1Click:Connect(function() gui:Destroy() end)

    -- Dragging functionality
    local dragging, dragInput, dragStart, startPos = false, nil, nil, nil
    title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = main.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input == dragInput then
            local delta = input.Position - dragStart
            main.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)

    -- Sidebar for tab icons (similar to image)
    local sidebar = UI:New("Frame",{
        Size=UDim2.new(0,80,1,-45),
        Position=UDim2.new(0,0,0,45),
        BackgroundColor3=UI.Theme.Secondary,
        Parent=main
    })
    UI:New("UICorner",{CornerRadius=UDim.new(0,0,0,12),Parent=sidebar})
    
    -- Content area
    local content = UI:New("Frame",{
        Size=UDim2.new(1,-80,1,-45),
        Position=UDim2.new(0,80,0,45),
        BackgroundTransparency=1,
        Parent=main
    })

    local window = {Tabs={}, Current=nil, Main=main, Sidebar=sidebar, Content=content, ConfigFile="UiLib_Config.json"}

    function window:SaveFile(name)
        self.ConfigFile = name
        if not isfile(name) then writefile(name,HttpService:JSONEncode({})) end
    end

    -- New function to create tabs with icons (similar to image)
    function window:CreateIconTab(name, iconText)
        local index = #self.Tabs
        local buttonSize = 60
        local button = UI:New("TextButton",{
            Size=UDim2.new(1,0,0,buttonSize),
            Position=UDim2.new(0,0,0,index*buttonSize),
            BackgroundTransparency=1,
            Text=iconText or name:sub(1,2),
            Font=UI.FontBold,
            TextSize=24,
            TextColor3=index==0 and UI.Theme.TabIconSelected or UI.Theme.TabIconUnselected,
            Parent=self.Sidebar
        })
        
        local tabLabel = UI:New("TextLabel",{
            Size=UDim2.new(1,0,0,20),
            Position=UDim2.new(0,0,1,-25),
            BackgroundTransparency=1,
            Text=name,
            Font=UI.Font,
            TextSize=12,
            TextColor3=index==0 and UI.Theme.TabIconSelected or UI.Theme.TabIconUnselected,
            Parent=button
        })
        
        local scroll = UI:New("ScrollingFrame",{
            Size=UDim2.new(1,0,1,0),
            CanvasSize=UDim2.new(),
            AutomaticCanvasSize=Enum.AutomaticSize.Y,
            ScrollBarThickness=4,
            ScrollBarImageColor3=UI.Theme.Accent,
            BackgroundTransparency=1,
            Visible=index==0,
            Parent=self.Content
        })
        UI:New("UIListLayout",{
            Padding=UDim.new(0,12),
            HorizontalAlignment=Enum.HorizontalAlignment.Center,
            Parent=scroll
        })
        
        button.MouseButton1Click:Connect(function()
            for _,t in pairs(self.Tabs) do 
                t.Content.Visible=false 
                t.Button.TextColor3=UI.Theme.TabIconUnselected
                if t.TabLabel then t.TabLabel.TextColor3=UI.Theme.TabIconUnselected end
            end
            scroll.Visible=true 
            button.TextColor3=UI.Theme.TabIconSelected
            if tabLabel then tabLabel.TextColor3=UI.Theme.TabIconSelected end
        end)
        
        local tab = {Button=button, Content=scroll, TabLabel=tabLabel}
        
        -- Modified AddButton to look like the image
        function tab:AddButton(text, icon, callback)
            local btnFrame = UI:New("Frame",{
                Size=UDim2.new(0.9,0,0,50),
                BackgroundColor3=UI.Theme.Button,
                Parent=self.Content
            })
            UI:New("UICorner",{CornerRadius=UDim.new(0,8),Parent=btnFrame})
            UI:New("UIStroke",{Color=UI.Theme.Stroke,Thickness=1,Parent=btnFrame})
            
            local iconLabel = UI:New("TextLabel",{
                Size=UDim2.new(0,40,1,0),
                BackgroundTransparency=1,
                Text=icon or "â–¶",
                Font=UI.FontBold,
                TextSize=20,
                TextColor3=UI.Theme.Text,
                Parent=btnFrame
            })
            
            local textLabel = UI:New("TextLabel",{
                Size=UDim2.new(1,-50,1,0),
                Position=UDim2.new(0,50,0,0),
                BackgroundTransparency=1,
                Text=text,
                Font=UI.Font,
                TextSize=14,
                TextColor3=UI.Theme.Text,
                TextXAlignment=Enum.TextXAlignment.Left,
                Parent=btnFrame
            })
            
            local btnHit = UI:New("TextButton",{
                Size=UDim2.new(1,0,1,0),
                BackgroundTransparency=1,
                Text="",
                Parent=btnFrame
            })
            
            if callback then 
                btnHit.MouseButton1Click:Connect(callback)
                -- Hover effect
                btnHit.MouseEnter:Connect(function()
                    TweenService:Create(btnFrame,TweenInfo.new(0.2),{
                        BackgroundColor3=Color3.fromRGB(
                            math.floor(UI.Theme.Button.R*255*1.2),
                            math.floor(UI.Theme.Button.G*255*1.2),
                            math.floor(UI.Theme.Button.B*255*1.2)
                        )
                    }):Play()
                end)
                btnHit.MouseLeave:Connect(function()
                    TweenService:Create(btnFrame,TweenInfo.new(0.2),{
                        BackgroundColor3=UI.Theme.Button
                    }):Play()
                end)
            end
            
            return btnFrame
        end
        
        -- Add other elements (Toggle, Slider, etc.) with similar styling
        function tab:AddToggle(text, default, callback)
            local frame = UI:New("Frame",{
                Size=UDim2.new(0.9,0,0,40),
                BackgroundTransparency=1,
                Parent=self.Content
            })
            
            local label = UI:New("TextLabel",{
                Size=UDim2.new(0.7,0,1,0),
                BackgroundTransparency=1,
                Text=text,
                Font=UI.Font,
                TextSize=14,
                TextColor3=UI.Theme.Text,
                TextXAlignment=Enum.TextXAlignment.Left,
                Parent=frame
            })
            
            local toggleFrame = UI:New("Frame",{
                Size=UDim2.new(0,50,0,24),
                Position=UDim2.new(1,-50,0.5,-12),
                BackgroundColor3=default and UI.Theme.ToggleOn or UI.Theme.ToggleOff,
                Parent=frame
            })
            UI:New("UICorner",{CornerRadius=UDim.new(0,12),Parent=toggleFrame})
            
            local toggleBtn = UI:New("TextButton",{
                Size=UDim2.new(1,0,1,0),
                BackgroundTransparency=1,
                Text="",
                Parent=toggleFrame
            })
            
            local state = default or false
            
            toggleBtn.MouseButton1Click:Connect(function()
                state = not state
                TweenService:Create(toggleFrame,TweenInfo.new(0.2),{
                    BackgroundColor3=state and UI.Theme.ToggleOn or UI.Theme.ToggleOff
                }):Play()
                if callback then callback(state) end
            end)
            
            return frame
        end
        
        -- Keep existing auto-save functions but with updated styling
        function tab:AddAutoToggle(text, default, callback)
            -- Similar to AddToggle but with auto-save functionality
            local frame = UI:New("Frame",{
                Size=UDim2.new(0.9,0,0,40),
                BackgroundTransparency=1,
                Parent=self.Content
            })
            
            local label = UI:New("TextLabel",{
                Size=UDim2.new(0.7,0,1,0),
                BackgroundTransparency=1,
                Text=text,
                Font=UI.Font,
                TextSize=14,
                TextColor3=UI.Theme.Text,
                TextXAlignment=Enum.TextXAlignment.Left,
                Parent=frame
            })
            
            local toggleFrame = UI:New("Frame",{
                Size=UDim2.new(0,50,0,24),
                Position=UDim2.new(1,-50,0.5,-12),
                BackgroundColor3=default and UI.Theme.AutoSaveOn or UI.Theme.AutoSaveOff,
                Parent=frame
            })
            UI:New("UICorner",{CornerRadius=UDim.new(0,12),Parent=toggleFrame})
            
            local toggleBtn = UI:New("TextButton",{
                Size=UDim2.new(1,0,1,0),
                BackgroundTransparency=1,
                Text="",
                Parent=toggleFrame
            })
            
            local state = default or false
            local cfg = {}
            if isfile(window.ConfigFile) then cfg = HttpService:JSONDecode(readfile(window.ConfigFile)) end
            if cfg[text] ~= nil then 
                state = cfg[text] 
                toggleFrame.BackgroundColor3 = state and UI.Theme.AutoSaveOn or UI.Theme.AutoSaveOff
            end
            
            toggleBtn.MouseButton1Click:Connect(function()
                state = not state
                TweenService:Create(toggleFrame,TweenInfo.new(0.2),{
                    BackgroundColor3=state and UI.Theme.AutoSaveOn or UI.Theme.AutoSaveOff
                }):Play()
                if callback then callback(state) end
                local cfg = {}
                if isfile(window.ConfigFile) then cfg = HttpService:JSONDecode(readfile(window.ConfigFile)) end
                cfg[text] = state
                writefile(window.ConfigFile,HttpService:JSONEncode(cfg))
            end)
            
            return frame
        end
        
        table.insert(self.Tabs,tab)
        return tab
    end

    return window
end

return UiLib
